# 健身管理系统新手文档（基于当前代码真实实现）

> 更新时间：2026-02-11  
> 适用目录：`e:\DATA\jianshen\code`  
> 目标读者：零基础同学（能跟着步骤跑起来，并看懂项目是怎么工作的）

---

## 1. 这个项目到底是什么？

这是一个 **健身数据分析 Web 系统**，分成三部分：

1. **前端（Vue 3）**：用户看到的页面，目录在 `frontend/`
2. **后端（Spring Boot）**：提供 API 和业务逻辑，目录在 `backend/`
3. **数据库（MySQL）**：存用户、训练计划、运动记录等数据，脚本在 `database/`

默认端口：

- 前端：`http://localhost:3000`
- 后端：`http://localhost:8080`
- MySQL：`localhost:3306`

---

## 2. 先看“它是怎么实现的”

### 2.1 技术栈（当前代码）

- 前端：`Vue 3` + `Vue Router` + `Pinia` + `Element Plus` + `ECharts` + `Vite`
- 后端：`Spring Boot 2.7.18` + `MyBatis-Plus 3.5.3.1` + `JWT`
- 数据库：`MySQL 8`

### 2.2 一次请求的完整链路

以“登录”举例：

1. 页面 `frontend/src/views/Login.vue` 收集用户名密码
2. 调用 `frontend/src/api/auth.js` 发起 `POST /api/auth/login`
3. 后端 `backend/src/main/java/com/gym/fitness/controller/AuthController.java`
4. 业务在 `AuthService.java`：查 `users` 表、校验 BCrypt 密码、签发 JWT
5. 前端把 token 存到 `localStorage`
6. 之后请求由 `frontend/src/api/request.js` 自动带上 `Authorization: Bearer ...`

### 2.3 权限控制怎么做的

- 路由守卫在 `frontend/src/router/index.js`（按 `role` 控制进入学生/教练/管理员页面）
- 后端没有单独的 Spring Security 过滤器，主要在各 Controller 里从 token 解析用户 ID（`JwtUtil`）

### 2.4 后端接口分层

- Controller：`backend/src/main/java/com/gym/fitness/controller/`
- Service：`backend/src/main/java/com/gym/fitness/service/`
- Mapper：`backend/src/main/java/com/gym/fitness/mapper/`
- Entity：`backend/src/main/java/com/gym/fitness/entity/`

统一返回结构是 `Result<T>`（`success/code/message/data`）。

---

## 3. 10 分钟跑起来（推荐）

### 3.1 先准备软件

必须安装：

- JDK 17+（后端 `pom.xml` 指定 `java.version=17`）
- Maven 3.6+
- Node.js 16+
- MySQL 8+

### 3.2 一键启动（最省心）

在 `code/` 目录双击：

```bat
start-all.bat
```

它会按顺序执行：方案B迁移（建库建表+导入真实数据+回填页面数据）→ 启动前后端。

---

## 4. 手动启动（最适合学习）

在 `e:\DATA\jianshen\code` 目录依次执行：

```bat
migrate-and-start.bat
```

然后浏览器打开：`http://localhost:3000`

### 4.1 默认数据库配置

当前代码默认使用：

- 用户名：`root`
- 密码：`123456`
- 库名：`gym_fitness_analytics`

如果你本地不是这个密码，需要同步改两处：

1. `backend/src/main/resources/application.yml`
2. `code` 目录下相关 `.bat` 脚本中的 `DB_USER`/`DB_PASS`

### 4.2 关于账号与真实数据模式

当前推荐流程是直接执行：

```bat
migrate-and-start.bat
```

该脚本会自动完成：
1. 建库建表（schema）
2. 导入真实清洗数据
3. 生成管理员/教练并分配学员
4. 补齐近期运动和体测
5. 重建成就与分析结果表
6. 回填 `exercise_records.created_at`
7. 启动前后端服务

常用参数：
- 仅迁移不启动：`migrate-and-start.bat --no-start --no-pause`
- 大数据模式：`migrate-and-start.bat --large`

默认可用示例账号：
- 管理员：`admin_auto_001 / 123456`
- 教练：`coach_auto_001 / 123456`

### 4.3 如何停止服务

```bat
stop.bat
```

注意：`stop.bat` 会结束所有 `java.exe` 和 `node.exe` 进程（如果你还有别的 Java/Node 项目在跑，会一起被结束）。

---

## 5. 当前“真实可用功能”说明

目前三端页面默认均走真实后端接口与落库数据。

特别说明（最近统一项）：
- 管理端 `Analytics` 与 `Monitoring` 的“时段活跃度”已统一口径（当天/近7天/近30天）
- 对应后端接口统一使用 `/api/analytics/hourly-activity?startDate&endDate`
- 教练待办处理接口已做参数兼容，前后端交互更稳

---

## 6. 关键 API 一览（便于你对照代码）

| 功能 | 后端入口 |
|---|---|
| 登录/注册 | `AuthController` (`/api/auth/*`) |
| 用户资料与密码 | `UserController` (`/api/user/*`) |
| 运动记录 | `ExerciseController` (`/api/exercise/*`) |
| 身体指标 | `BodyMetricController` (`/api/bodymetric/*`) |
| 训练计划 | `TrainingPlanController` (`/api/plan/*`) |
| 成就 | `AchievementController` (`/api/achievement/*`) |
| 分析与排行榜 | `AnalyticsController` (`/api/analytics/*`) |
| 管理端接口 | `AdminController` (`/api/admin/*`) |

---

## 7. 新手建议的阅读顺序（最快理解实现）

1. `frontend/src/router/index.js`（先懂页面结构和权限）
2. `frontend/src/api/request.js`（先懂 token 如何自动携带）
3. `backend/src/main/java/com/gym/fitness/controller/AuthController.java`
4. `backend/src/main/java/com/gym/fitness/service/AuthService.java`
5. `backend/src/main/java/com/gym/fitness/common/util/JwtUtil.java`
6. 挑一个完整业务（推荐“运动日历”）：
   - 前端：`views/student/Calendar.vue` → `api/exercise.js`
   - 后端：`ExerciseController` → `ExerciseService` → `ExerciseRecordMapper`

这样一条链路看完，你会对整个项目实现有 80% 的理解。

---

## 8. 常见问题与排查

### Q1：后端启动报数据库连接错误

检查：

- MySQL 是否启动
- 用户名密码是否与 `application.yml` 一致
- 库是否存在（`gym_fitness_analytics`）

### Q2：前端能打开但登录失败

检查数据库里是否有可登录用户；纯净模式初始化后，`users` 表默认为空，需要先导入真实用户数据。

### Q3：端口冲突（3000/8080）

- 关闭占用进程，或修改：
  - 前端端口：`frontend/vite.config.js`
  - 后端端口：`backend/src/main/resources/application.yml`

### Q4：下载依赖很慢

- Maven：配置国内镜像（阿里云等）
- npm：`npm config set registry https://registry.npmmirror.com`

---

## 9. 你可以继续做什么（下一步）

如果你已经能跑起来，建议下一步按优先级：

1. 增加 CI 自动化（提交后自动运行 `api_smoke_check.py`）
2. 统一枚举和值（角色、目标类型、成就类型）
3. 补一个后端统一鉴权拦截器（减少 Controller 手动解析 token）
4. 为关键业务补自动化测试（登录、运动记录、身体指标）

---

如果你愿意，我下一步可以再给你补一份“**从登录到运动记录的调试实战清单**”（按点击步骤和断点位置写，适合第一次 Debug）。
